#!/bin/sh

# gen-scripts: Generates OMERO script wrappers for ImageJ modules.

set -e

# -- Subroutines --

die () {
	echo "$*" >&2
	exit 1
}

imagej_exec () {
	ARCH="$(getconf LONG_BIT)"
	case "$(uname)" in
		Linux)
			echo "ImageJ-linux$ARCH"
			;;
		Darwin)
			echo "Contents/MacOS/ImageJ-macosx"
			;;
		CYGWIN)
			echo "ImageJ-win$ARCH"
			;;
		*)
			echo "ImageJ"
			;;
	esac
}

# -- Determine OMERO and ImageJ directories --

test $# = 1 ||
	die "Usage: $0 <path/to/omero> [--all]"

omero="$1"

test -f "$omero/lib/server/blitz.jar" ||
	die "Invalid OMERO installation: $omero"

imagej="$(cd $(dirname "$0")/.. && pwd)"

test -d "$imagej/jars" ||
	die "Invalid ImageJ installation: $imagej"

# -- Generate scripts using ImageJ --

"$imagej/$(imagej_exec)" --headless --full-classpath \
	--main-class net.imagej.omero.ScriptGenerator $@
